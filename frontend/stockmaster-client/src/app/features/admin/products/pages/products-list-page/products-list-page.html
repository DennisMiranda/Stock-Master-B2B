<div class="space-y-6">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Gestión de Productos</h1>
            <p class="text-sm text-gray-500 mt-1">Administra el catálogo de productos B2B</p>
        </div>

        <button (click)="openCreateModal()"
            class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg shadow-sm transition-all text-sm font-medium cursor-pointer">
            <lucide-icon [img]="PlusIcon" class="w-4 h-4"></lucide-icon>
            Nuevo Producto
        </button>
    </div>

    <!-- Search & Stats -->
    <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col sm:flex-row gap-4">
        <app-search-input [control]="searchControl" placeholder="Buscar por nombre, SKU o marca..."
            class="w-full sm:w-96" />
        <div class="hidden sm:flex items-center gap-3 ml-auto text-sm text-gray-500">
            <div class="px-3 py-1 bg-gray-50 rounded-lg border border-gray-200">
                Total: <span class="font-bold text-gray-900">{{ totalProducts() }}</span>
            </div>
            <div class="px-3 py-1 bg-green-50 rounded-lg border border-green-200 text-green-700">
                Activos: <span class="font-bold">{{ activeProductsCount() }}</span>
            </div>
        </div>
    </div>

    <!-- Table -->
    <!-- Table -->
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden flex flex-col">
        <app-data-table [data]="products()" [columns]="columns">
        </app-data-table>

        <div class="p-4 border-t border-gray-100 bg-gray-50 flex justify-end">
            <app-basic-pagination [page]="currentPage()" [totalPages]="totalPages()"
                (pageChange)="onPageChange($event)" />
        </div>
    </div>

    <!-- Templates -->
    <ng-template #imageTemplate let-item>
        <div class="w-12 h-12 rounded-lg bg-gray-100 overflow-hidden border border-gray-200">
            @if(item.images?.length > 0) {
            <img [src]="item.images[0]" class="w-full h-full object-cover">
            } @else {
            <div class="w-full h-full flex items-center justify-center text-gray-400 text-xs">No img</div>
            }
        </div>
    </ng-template>

    <ng-template #priceTemplate let-item>
        <div class="flex flex-col">
            <span class="font-medium text-gray-900">S/ {{ item.prices?.[0]?.price || 0 }}</span>
            <span class="text-xs text-gray-500">Unitario</span>
        </div>
    </ng-template>

    <ng-template #stockTemplate let-item>
        <div class="flex flex-col">
            <span class="font-medium text-gray-900">{{ item.stockUnits }} Unid.</span>
            <span class="text-xs text-gray-500">{{ item.stockBoxes }} Cajas</span>
        </div>
    </ng-template>

    <ng-template #statusTemplate let-item>
        @if (item.isActive) {
        <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">Activo</span>
        } @else {
        <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">Inactivo</span>
        }
    </ng-template>

    <ng-template #actionsTemplate let-item>
        <div class="flex items-center gap-2 justify-end" (click)="$event.stopPropagation()">
            <button (click)="openEditModal(item)" class="p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors"
                aria-label="Editar">
                <lucide-icon [img]="EditIcon" class="w-4 h-4" />
            </button>
            <button (click)="onDelete(item)" class="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                aria-label="Eliminar">
                <lucide-icon [img]="TrashIcon" class="w-4 h-4" />
            </button>
        </div>
    </ng-template>

    <!-- Modal -->
    @if (isModalOpen()) {
    <app-product-modal [product]="selectedProduct()" [isSaving]="isSaving()" (save)="onSave($event)"
        (close)="closeModal()">
    </app-product-modal>
    }

    <!-- Confirmation Modal -->
    <app-confirmation-modal #deleteModal title="Eliminar Producto"
        message="¿Estás seguro de que deseas eliminar este producto? Esta acción no se puede deshacer."
        confirmText="Sí, eliminar" cancelText="Cancelar" type="danger"
        (confirm)="onDeleteConfirmed()"></app-confirmation-modal>
</div>