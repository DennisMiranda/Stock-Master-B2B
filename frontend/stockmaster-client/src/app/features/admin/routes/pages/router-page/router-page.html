<div class="grid grid-cols-1 lg:grid-cols-7 gap-6 space-y-2 pb-2">
  <!-- Mapa (60%) -->
  <div class="flex flex-col lg:col-span-4 xl:col-span-4">
    <header class="space-y-2 mb-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">Panel de Entregas</h1>
          <p class="text-sm text-gray-600">Gesti√≥n en tiempo real de conductores y pedidos</p>
        </div>
        @if (hasActiveFilter()) {
          <button
            (click)="resetMapFilter()"
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium rounded-lg transition-colors"
          >
            Ver todo
          </button>
        }
      </div>
    </header>
    
        <app-map-router 
      [drivers]="filteredDrivers()" 
      [orders]="filteredOrders()" 
      [entregas]="filteredEntregas()"
      [routes]="filteredRoutes()"
    />


  </div>

  <!-- Tabs (40%) -->
  <div class="lg:col-span-3 space-y-4 h-[calc(100vh-200px)] w-full min-h-[400px] flex flex-col">
    <!-- Tab Headers -->
    <div class="flex gap-2">
      @for (tab of tabs; track tab.key) {
        <button
          (click)="activeTab.set(tab.key); resetMapFilter()"
          [class]="
            activeTab() === tab.key
              ? 'bg-gray-900 text-white'
              : 'bg-white text-gray-600 hover:bg-gray-50'
          "
          class="flex-1 px-2 py-3 rounded-lg shadow-sm border border-gray-100 font-semibold transition-all flex items-center justify-center gap-2"
        >
          <lucide-icon [img]="tab.icon" class="w-5 h-5"></lucide-icon>
          <span class="hidden sm:inline text-sm">{{ tab.label }}</span>
        </button>
      }
    </div>

    <!-- Tab Content -->
    <div class="flex-1 bg-white rounded-xl shadow-sm overflow-hidden flex flex-col">
      
      <!-- Loading State -->
      @if (loading()) {
        <div class="flex-1 flex items-center justify-center">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-gray-900"></div>
            <p class="mt-4 text-gray-600">Cargando datos...</p>
          </div>
        </div>
      }


      @if (activeTab() === 'drivers' && !loading()) {
        <div class="flex-1 overflow-y-auto p-4">
          @if (drivers().length === 0) {
            <div class="flex items-center justify-center h-full">
              <p class="text-gray-500">No hay conductores disponibles</p>
            </div>
          } @else {
            <div class="space-y-3">
              @for (driver of drivers(); track driver.id) {
                <app-driver-card
                  [driver]="driver"
                  [isSelected]="selectedDriverId() === driver.id"
                  (cardClick)="onDriverClick($event)"
                  (assignRoute)="assignRouteToDriver($event)"
                />
              }
            </div>
          }
        </div>
      }

      <!-- üì¶ ORDERS TAB -->
      @if (activeTab() === 'orders' && !loading()) {
        <div class="flex-1 overflow-y-auto p-4">
          @if (orders().length === 0) {
            <div class="flex items-center justify-center h-full">
              <p class="text-gray-500">No hay pedidos disponibles</p>
            </div>
          } @else {
            <div class="space-y-3">
              @for (order of orders(); track order.id) {
                <app-order-card
                  [order]="order"
                  [isSelected]="selectedOrderId() === order.id"
                  (cardClick)="onOrderClick($event)"
                  (assignToRoute)="assignOrderToRoute($event)"
                  (viewDetails)="viewOrderDetails($event)"
                />
              }
            </div>
          }
        </div>
      }


      @if (activeTab() === 'routes' && !loading()) {
        <div class="flex-1 overflow-y-auto p-4">
          @if (routes().length === 0) {
            <div class="flex items-center justify-center h-full">
              <p class="text-gray-500">No hay rutas disponibles</p>
            </div>
          } @else {
            <div class="space-y-3">
              @for (route of routes(); track route.id) {
                <app-route-card
                  [route]="route"
                  [isSelected]="selectedRouteId() === route.id"
                  (cardClick)="onRouteClick($event)"
                  (assignDriver)="assignDriverToRoute($event)"
                  (viewDetails)="viewRouteDetails($event)"
                />
              }
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>