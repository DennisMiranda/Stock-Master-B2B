<div class="grid grid-cols-1  lg:grid-cols-7 gap-6 space-y-2 pb-2">
  <!-- Mapa (60%) -->
  <div class="flex flex-col lg:col-span-4 xl:col-span-4">
    <header class="space-y-2 mb-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">Panel de Entregas</h1>
          <p class="text-sm text-gray-600">Gesti√≥n en tiempo real de conductores y pedidos</p>
        </div>
        @if (hasActiveFilter()) {
        <button
          (click)="resetMapFilter()"
          class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium rounded-lg transition-colors"
        >
          Ver todo
        </button>
        } @if (error()) {
        <div class="bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2">
          <svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
              clip-rule="evenodd"
            />
          </svg>
          <span class="text-sm text-red-800">{{ error() }}</span>
          <button (click)="refreshData()" class="ml-auto text-red-600 hover:text-red-800">
            Reintentar
          </button>
        </div>
        }
      </div>
    </header>

    <app-map-router
      [drivers]="filteredDrivers()"
      [orders]="filteredOrders()"
      [entregas]="filteredEntregas()"
      [routes]="filteredRoutes()"
    />
  </div>

  <!-- Tabs (40%) -->
  <div class="lg:col-span-3 space-y-4 h-[calc(100vh-200px)] w-full min-h-[400px] flex flex-col">
    <!-- Tab Headers -->
    <ul class="flex gap-2 lg:flex-col xl:flex-row ">
      @for (tab of tabs; track tab.key) {
      <button
        (click)="activeTab.set(tab.key); resetMapFilter()"
        [class]="
          activeTab() === tab.key
            ? 'bg-azul text-white'
            : 'bg-white text-gray-600 hover:bg-gray-50'
        "
        class="flex-1 px-2 active:scale-95 py-3 rounded-sm border border-gray-100 font-semibold transition-all flex items-center justify-center gap-2"
      >
        <lucide-icon [img]="tab.icon" class="w-5 h-5"></lucide-icon>
        <span class="hidden sm:inline text-sm">{{ tab.label }}</span>
      </button>
      }
    </ul>

    <!-- Tab Content -->
    <div class="flex-1 bg-white overflow-hidden flex flex-col">
      <!-- Loading State -->
      @if (loading()) {
      <div class="flex-1 flex items-center justify-center">
        <div class="text-center">
          <div
            class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-gray-900"
          ></div>
          <p class="mt-4 text-gray-600">Cargando datos...</p>
        </div>
      </div>
      } @if (activeTab() === 'drivers' && !loading()) {
      <section class="flex-1 overflow-y-auto p-4">
        @if (drivers().length === 0) {
        <div class="flex items-center justify-center h-full">
          <p class="text-gray-500">No hay conductores disponibles</p>
        </div>
        } @else {
        <ul class="space-y-2 flex flex-col">
          @for (driver of drivers(); track driver.id) {
          <app-driver-card
            [driver]="driver"
            [isSelected]="selectedDriverId() === driver.id"
            (cardClick)="onDriverClick($event)"
            (changeStatus)="onDriverChangeStatus($event)"
          />
          }
        </ul>
        }
      </section>
      }

      <!-- üì¶ ORDERS TAB -->
      @if (activeTab() === 'orders' && !loading()) {
      <section class="flex-1 overflow-y-auto p-4">
        @if (ordersReady().length === 0) {
        <div class="flex items-center justify-center h-full">
          <p class="text-gray-500">No hay pedidos disponibles</p>
        </div>
        } @else {
        <ul class="space-y-2 flex flex-col">
          @for (order of ordersReady(); track order.id) {
          <app-order-card
            [order]="order"
            [isSelected]="selectedOrderId() === order.id"
            (cardClick)="onOrderClick($event)"
            (assignToRoute)="assignOrderToRoute($event)"
            (changeStatus)="onOrderChangeStatus($event)"
            (cancelOrder)="onOrderCancel($event)"
          />
          }
        </ul>
        }
      </section>
      }

      <!-- üöö ROUTES TAB -->
@if (activeTab() === 'routes' && !loading()) {
<section class="flex-1 overflow-y-auto p-4">
  <!-- ‚úÖ Bot√≥n para crear ruta -->
  <div class="mb-4">
    <button
      (click)="showCreateRouteModal.set(true)"
      class="w-full px-4 py-3 border border-gray-200 text-gray-900 shadow font-semibold rounded-lg hover:bg-azul hover:text-white active:text-white active:scale-95 duration-500 active:bg-azul transition-colors flex items-center justify-center gap-2"
    >
      <lucide-icon [img]="PlusIcon" class="w-5 h-5"></lucide-icon>
      Crear Nueva Ruta
    </button>
  </div>

  @if (routes().length === 0) {
  <div class="flex items-center justify-center h-full">
    <p class="text-gray-500">No hay rutas disponibles</p>
  </div>
  } @else {
  <ul class="space-y-2 flex flex-col  gap-4">
    @for (route of routes(); track route.id) {
    <app-route-card
      [route]="route"
      [isSelected]="selectedRouteId() === route.id"
      (cardClick)="onRouteClick($event)"
      (startRoute)="onRouteStart($event)"
      (completeRoute)="onRouteComplete($event)"
      (cancelRoute)="onRouteCancel($event)"
      (markOrderDelivered)="onMarkOrderDelivered($event)"
      (removeOrder)="onRemoveOrder($event)"
    />
    }
  </ul>
  }
</section>
}


    </div>
  </div>
  @if (showAssignModal()) {
  <app-assign-route-modal
    [routes]="routes()"
    (routeSelected)="onRouteSelected($event)"
    (close)="closeAssignModal()"
  />
  }
  <!-- ‚úÖ Modal de crear ruta -->
@if (showCreateRouteModal()) {
  <app-create-route-modal
    (close)="showCreateRouteModal.set(false)"
    (create)="onCreateRoute($event)"
  />
}
</div>
